<apex:page applyBodyTag="false" applyHtmlTag="false" id="HOP_ApplicationForm" controller="HOP_ApplicationFormController"
		   docType="HTML-5.0" showChat="false" showHeader="false" sidebar="false" standardStylesheets="false">
	<apex:composition template="HOP_Template">
		<apex:define name="title">New Application Entry Form</apex:define>

		<apex:define name="styles">
			<link rel="stylesheet" href="{!URLFOR($Resource.HOP, '/css/jquery.datetimepicker.css')}" />
			<link rel="stylesheet" href="{!URLFOR($Resource.SalesforceDataTables, '/css/dataTables.bootstrap.min.css')}" />

			<style type="text/css">
				ul.fileList {
					display: inline-block;
					padding-left: 15px;
					margin-bottom: 0;
				}
				ul.fileList li {
					border-bottom: 1px solid #ddd;
					padding: 5px;
				}
				ul.fileList li:last-child {
					border-bottom: none;
				}
				.dependentPicklistWrapper select {
					display: block;
					width: 100%;
					height: 34px;
					padding: 6px 12px;
					font-size: 14px;
					line-height: 1.42857143;
					color: #555;
					background-color: #fff;
					background-image: none;
					border: 1px solid #ccc;
					border-radius: 4px;
					-webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
					box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
					-webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
					-o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
					transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
				}
				.dependentPicklistWrapper select[disabled] {
					background-color: #eee;
					cursor: not-allowed;
				}
				.tt-query {
					-webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
					-moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
					box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
				}
				.tt-hint {
					color: #999
				}
				.tt-dropdown-menu {
					width: 100%;
					margin-top: 5px;
					padding: 8px 0;
					background-color: #fff;
					border: 1px solid #ccc;
					border: 1px solid rgba(0, 0, 0, 0.2);
					-webkit-border-radius: 0;
					-moz-border-radius: 0;
					border-radius: 0;
					-webkit-box-shadow: 0 5px 10px rgba(0,0,0,.2);
					-moz-box-shadow: 0 5px 10px rgba(0,0,0,.2);
					box-shadow: 0 5px 10px rgba(0,0,0,.2);
				}
				.tt-suggestion {
					padding: 3px 20px;
					font-size: inherit;
					line-height: 1.5em;
				}
				.tt-suggestion.tt-cursor {
					color: #fff;
					background-color: #0097cf;
				}
				.tt-suggestion p {
					margin: 0;
					font-size: 1em;
				}
				.tt-dataset-genericDataset {
					max-height: 200px;
					overflow-y: auto;
					overflow-x: hidden;
				}
				tr.selected {
					background-color: #B0BED9 !important;
				}
				.bootbox.bootbox-confirm {
					height: 100%;
				}
				.bootbox.bootbox-confirm .modal-dialog {
					top: 50%;
					transform: translateY(-50%);
				}
				p.doubleSpacing {
					margin-bottom: 20px;
				}
				hr {
					border-top-color: #ddd;
				}
				img.form-control {
					border: transparent;
					display:initial;
				   
				}
			</style>
		</apex:define>

		<apex:define name="error">
			<div class="top-general-alert alert alert-danger slide down" role="alert" aria-hidden="true" aria-label="Page Alerts">
				<apex:messages styleClass="errorArea" id="errorMessages" />
			</div>
		</apex:define>

		<apex:define name="body">
		<div id="myFormWrapper">
			<apex:form styleClass="form-horizontal" rendered="{! !hasErrors }" id="myForm">
				<apex:actionFunction name="rerenderPicklists" reRender="neighborhoodPreference, dthpPreference, copPreference, liveInSfPreference, workInSfPreference" />
				<apex:actionFunction name="saveApplicationForm" action="{!saveApplicationForm}" />
				<apex:actionFunction name="saveApplicationFormAndNew" action="{!saveApplicationFormAndNew}" />
				
				<apex:outputPanel layout="block" rendered="{! !ISBLANK(retUrl) }">
					<div class="form-group">
						<div class="col-xs-12">
							<a href="{!retUrl}">Back to previous page</a>
						</div>
					</div>
				</apex:outputPanel>
				<div class="form-group">
					<div class="col-xs-12 sectionHeader">
						<apex:outputPanel layout="none" rendered="{!app.Id == null}">
							<h4>New Application</h4>
						</apex:outputPanel>
						<apex:outputPanel layout="none" rendered="{!app.Id != null}">
							<h4>{! 'Application ' + appName.Name }</h4>
						</apex:outputPanel>
						<apex:commandButton styleClass="btn btn-primary" value="Save"
											onclick="sanitizeFields(); checkRequiredFields_primaryApplicant(saveApplicationForm); return false;" />
						<apex:commandButton styleClass="btn btn-primary" value="Save & New"
											onclick="sanitizeFields(); checkRequiredFields_primaryApplicant(saveApplicationFormAndNew); return false;" />
					</div>
				</div>
				<div style="padding-top: 15px;">
					<h4>Name of Listing:&nbsp;<apex:outputText value="{!listingName}" /></h4>
				</div>
				<div class="section form-group-section">
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Lottery Number (Paper Ticket)</label>
								<div class="col-sm-6">
										<apex:inputField value="{!app.Lottery_Number_Manual__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Language of Application</label>
								<div class="col-sm-6">
									<apex:inputField value="{!app.Application_Language__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Household Annual Income</label>
								<div class="col-sm-6">
									<apex:inputField value="{!app.Annual_Income__c}" styleClass="form-control" onblur="rerenderPicklists()">
										<apex:actionSupport event="onkeyup" action="{!getMonthlyRentPecentage}" rerender="rentBurdenHelpText" oncomplete="eligibleForRBP({!monthlyRentPecentage})"/>
									</apex:inputField>
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Housing Voucher / Subsidy</label>
								<div class="col-sm-6">
									<apex:inputField value="{!app.Housing_Voucher_or_Subsidy__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
					</div>
					<!-- <apex:outputPanel rendered="{!isTotalMonthlyRentEditable}" layout="none">
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Total Monthly Rent</label>
								<div class="col-sm-6">
									<apex:inputField value="{!app.Total_Monthly_Rent__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
					</div>
					</apex:outputPanel> -->
				</div>
				<div class="form-group">
					<div class="col-xs-12 sectionHeader">
						<h5>Primary Applicant Information</h5>
					</div>
				</div>
				<div id="primaryApplicantSection" class="section form-group-section">
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">First Name</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.First_Name__c}" styleClass="form-control required" onblur="rerenderPicklists()" />
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Middle Name</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Middle_Name__c}" styleClass="form-control" onblur="rerenderPicklists()" />
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Last Name</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Last_Name__c}" styleClass="form-control required" onblur="rerenderPicklists()" />
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Date of Birth</label>
								<div class="col-sm-6">
									<div class="hidden">
										<apex:inputField value="{!primaryApplicant.Date_of_Birth__c}" id="dateOfBirth" />
									</div>
									<input type="text" class="form-control required" id="dateOfBirth" />
								</div>
							</div>
						</div>
					</div>
					<div class="form-group">
						<div class="col-xs-12">
							<h5>Residence Address</h5>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Street</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Street__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">City</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.City__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">State</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.State__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Zip Code</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Zip_Code__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
					</div>
					<div class="form-group">
						<div class="col-xs-12">
							<h5>Mailing Address</h5>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Street</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Mailing_Street__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">City</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Mailing_City__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">State</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Mailing_State__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Zip Code</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Mailing_Zip_Code__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<div class="col-sm-6">
									<label class="control-label pull-left" style="margin-right: 5px;">Phone</label>
									<div style="overflow: hidden;">
										<apex:inputField value="{!primaryApplicant.Phone_Type__c}" styleClass="form-control" style="display: inline-block; width: 100%;" />
									</div>
								</div>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Phone__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Email</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Email__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="form-group">
					<div class="col-xs-12 sectionHeader">
						<h5>Household Members</h5>
					</div>
				</div>

				<apex:actionRegion >
					<apex:outputPanel layout="block" styleClass="section text-center" id="householdMembersSection">
						<div class="form-group">
							<div class="col-xs-12">
								<div class="section">
									<apex:outputPanel layout="none" rendered="{!householdMembers.size == 0}">
										<p style="margin: 0;">No Household Members</p>
									</apex:outputPanel>
									<apex:outputPanel layout="none" rendered="{!householdMembers.size > 0}">
										<table class="table table-striped table-bordered" id="householdMembersTable">
											<thead>
												<tr>
													<th>First Name</th>
													<th>Middle Name</th>
													<th>Last Name</th>
													<th>Date of Birth</th>
													<th>Street</th>
													<th>City</th>
													<th>State</th>
													<th>Zip Code</th>
												</tr>
											</thead>
											<tbody>
												<apex:repeat value="{!householdMembersIndexes}" var="idx">
													<tr onclick="onHouseholdMemberRowClick(this, {!idx});">
														<td><apex:outputField value="{!householdMembers[idx].First_Name__c}" /></td>
														<td><apex:outputField value="{!householdMembers[idx].Middle_Name__c}" /></td>
														<td><apex:outputField value="{!householdMembers[idx].Last_Name__c}" /></td>
														<td><apex:outputField value="{!householdMembers[idx].Date_of_Birth__c}" /></td>
														<td><apex:outputField value="{!householdMembers[idx].Street__c}" /></td>
														<td><apex:outputField value="{!householdMembers[idx].City__c}" /></td>
														<td><apex:outputField value="{!householdMembers[idx].State__c}" /></td>
														<td><apex:outputField value="{!householdMembers[idx].Zip_Code__c}" /></td>
													</tr>
												</apex:repeat>
											</tbody>
										</table>
									</apex:outputPanel>
								</div>
							</div>
						</div>
	
						<apex:inputHidden id="selectedHouseholdMemberIdx" value="{!selectedHouseholdMemberIdx}" />
	
						<apex:commandButton styleClass="btn btn-primary" value="New"
											rendered="{!currentHouseholdMember == null}"
											action="{!newHouseholdMember}" reRender="householdMembersSection, errorMessages"
											oncomplete="afterNewHouseholdMemberClick()" />
						<apex:commandButton styleClass="btn btn-primary" value="Edit"
											rendered="{!currentHouseholdMember == null && householdMembers.size > 0}"
											action="{!editHouseholdMember}" reRender="householdMembersSection, errorMessages"
											oncomplete="afterEditHouseholdMemberClick()"
											id="householdMemberEdit" />
						<apex:commandButton styleClass="btn btn-primary" value="Delete"
											onclick="beforeDeleteHouseholdMember(); return false;"
											rendered="{!currentHouseholdMember == null && householdMembers.size > 0}"
											id="householdMemberDelete" />
	
						<apex:outputPanel layout="none" rendered="{!currentHouseholdMember != null}">
							<div id="householdMemberSection">
								<div class="row">
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">First Name</label>
											<div class="col-sm-6">
												<apex:inputField value="{!currentHouseholdMember.First_Name__c}" styleClass="form-control required"
																 id="householdMemberFirstName" />
											</div>
										</div>
									</div>
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">Middle Name</label>
											<div class="col-sm-6">
												<apex:inputField value="{!currentHouseholdMember.Middle_Name__c}" styleClass="form-control" />
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">Last Name</label>
											<div class="col-sm-6">
												<apex:inputField value="{!currentHouseholdMember.Last_Name__c}" styleClass="form-control required" />
											</div>
										</div>
									</div>
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">Date of Birth</label>
											<div class="col-sm-6">
												<div class="hidden">
													<apex:inputField value="{!currentHouseholdMember.Date_of_Birth__c}" id="dateOfBirth_chm" />
												</div>
												<input type="text" class="form-control required" id="dateOfBirth_chm" />
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">Street</label>
											<div class="col-sm-6">
												<apex:inputField value="{!currentHouseholdMember.Street__c}" styleClass="form-control" />
											</div>
										</div>
									</div>
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">City</label>
											<div class="col-sm-6">
												<apex:inputField value="{!currentHouseholdMember.City__c}" styleClass="form-control" />
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">State</label>
											<div class="col-sm-6">
												<apex:inputField value="{!currentHouseholdMember.State__c}" styleClass="form-control" />
											</div>
										</div>
									</div>
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">Zip Code</label>
											<div class="col-sm-6">
												<apex:inputField value="{!currentHouseholdMember.Zip_Code__c}" styleClass="form-control" />
											</div>
										</div>
									</div>
								</div>
							</div>
						</apex:outputPanel>
	
						<apex:actionFunction name="addHouseholdMember" action="{!addHouseholdMember}"
											 reRender="householdMembersSection, specialProgramPreferencesSection, errorMessages"
											 oncomplete="afterAddHouseholdMemberClick()" />
						<apex:actionFunction name="addHouseholdMemberAndNew" action="{!addHouseholdMemberAndNew}"
											 reRender="householdMembersSection, specialProgramPreferencesSection, errorMessages"
											 oncomplete="afterAddHouseholdMemberAndNewClick()" />
						<apex:actionFunction name="saveHouseholdMember" action="{!saveHouseholdMember}"
											 reRender="householdMembersSection, specialProgramPreferencesSection, errorMessages"
											 oncomplete="cancelHouseholdMember()" />
						<apex:actionFunction name="cancelHouseholdMember" action="{!cancelHouseholdMember}"
											 reRender="householdMembersSection, errorMessages" immediate="true"
											 oncomplete="afterCancelHouseholdMemberClick()" />
						<apex:actionFunction name="deleteHouseholdMember" action="{!deleteHouseholdMember}"
											 reRender="householdMembersSection, errorMessages"
											 oncomplete="afterDeleteHouseholdMember()" />
	
						<!--
						<apex:commandButton styleClass="btn btn-primary" value="Add"
											rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx == -1}"
											onclick="checkRequiredFields_householdMember(addHouseholdMember); return false;" />
						<apex:commandButton styleClass="btn btn-primary" value="Add & New"
											rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx == -1}"
											onclick="checkRequiredFields_householdMember(addHouseholdMemberAndNew); return false;" />
						<apex:commandButton styleClass="btn btn-primary" value="Save"
											rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx != -1}"
											onclick="checkRequiredFields_householdMember(saveHouseholdMember); return false;" />
						<apex:commandButton styleClass="btn btn-primary" value="Cancel"
											rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx != -1}"
											onclick="cancelHouseholdMember(); return false;" />
						-->
	
						<apex:outputPanel layout="none" rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx == -1}">
							<button type="button" class="btn btn-primary" onclick="sanitizeFields(); checkRequiredFields_householdMember(addHouseholdMember);">Add</button>
						</apex:outputPanel>
						<apex:outputPanel layout="none" rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx == -1}">
							<button type="button" class="btn btn-primary" onclick="sanitizeFields(); checkRequiredFields_householdMember(addHouseholdMemberAndNew);">Add &amp; New</button>
						</apex:outputPanel>
						<apex:outputPanel layout="none" rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx != -1}">
							<button type="button" class="btn btn-primary" onclick="sanitizeFields(); checkRequiredFields_householdMember(saveHouseholdMember);">Save</button>
						</apex:outputPanel>
						<apex:outputPanel layout="none" rendered="{!currentHouseholdMember != null}">
							<button type="button" class="btn btn-primary" onclick="cancelHouseholdMember();">Cancel</button>
						</apex:outputPanel>
					</apex:outputPanel>
				</apex:actionRegion>
				
				<div class="form-group">
					<div class="col-xs-12 sectionHeader">
						<h5>Reserved and Priority Qualifying Information</h5>
					</div>
				</div>
				<div class="section form-group-section">
					<div class="row">
						<apex:outputPanel rendered="{!hasDevelopmentalDisabilitiesUnits}">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Reserved - Developmentally Disabled</label>
								<div class="col-sm-6">
									<apex:inputField value="{!app.Has_DevelopmentalDisability__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
						</apex:outputPanel>
						<apex:outputPanel rendered="{!!ISBLANK(listing.Reserved_community_type__c)}">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Meets Community Requirements</label>
								<div class="col-sm-6">
									<apex:inputField value="{!app.Answered_Community_Screening__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
						</apex:outputPanel>
					</div>
					<apex:outputPanel rendered="{!hasVeteransUnits}">
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Reserved - U.S. Military</label>
								<div class="col-sm-6">
									<apex:inputField value="{!app.Has_Military_Service__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
					</div>
					</apex:outputPanel>
					<div class="row">
						<div class="col-sm-12">
							<div class="form-group">
								<label class="col-sm-3 control-label">ADA Priorities Selected</label>
								<div class="col-sm-9">
									<apex:inputField value="{!app.Has_ADA_Priorities_Selected__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
					</div>
				</div>
				
				
				<div class="form-group">
					<div class="col-xs-12 sectionHeader">
						<h5>Preferences</h5>
					</div>
				</div>
				
				<apex:actionRegion >
					<apex:outputPanel layout="block" styleClass="section" id="specialProgramPreferencesSection">
						<div class="form-group">
							<div class="col-xs-12">
								<div class="section">
									<apex:outputPanel layout="none" rendered="{!shortFormPreferences.size == 0}">
										<p style="margin: 0;">No Preferences</p>
									</apex:outputPanel>
									<apex:outputPanel layout="none" rendered="{!shortFormPreferences.size > 0}">
										<table class="table table-bordered" id="shortFormPreferencesTable2">
											<thead>
												<tr>
													<!-- <th>Preference</th>
													<th>Individual Preference</th>
													<th>Application Member Name</th>
													<th>Type of Proof</th>
													<th>Applicant Opted Out</th>
													<th>Pre-Lottery Validation</th>
													<th>Preference Rank</th> -->
													
													<th>Receives Preference</th>
													<th>Preference Name</th>
													<th>Pre-Lottery Validation</th>
													<th>Person Who Claimed</th>
													<th>Type of Proof</th>
													<th>Lottery Rank</th>
													<th>Opt Out</th>
												</tr>
											</thead>
											<tbody>
												<apex:repeat value="{!shortFormPreferencesIndexes}" var="idx">
													<tr onclick="onShortFormPreferenceRowClick(this, {!idx});" style="background-color: {!IF(shortFormPreferences[idx].receivesPreference,'','#F9F9F9')}">
														<!-- <td><apex:outputText value="{!shortFormPreferences[idx].receivesPreference}" /></td> -->
														<td style="text-align: center;">
															<apex:outputPanel rendered="{!shortFormPreferences[idx].prefOrder < 1000}" layout="none">
																<span class="glyphicon glyphicon-ok-sign text-success"></span>
															</apex:outputPanel>
															<apex:outputPanel rendered="{!shortFormPreferences[idx].prefOrder >= 1000 && shortFormPreferences[idx].prefOrder < 2000}" layout="none">
																<span class="glyphicon glyphicon-remove-sign" style="color: red;"></span>
															</apex:outputPanel>
															<apex:outputPanel rendered="{!shortFormPreferences[idx].prefOrder >= 2000}" layout="none">
																<span class="glyphicon glyphicon-remove-sign" style="color: grey;"></span>
															</apex:outputPanel>
														</td>
														<td><apex:outputText value="{!shortFormPreferences[idx].listingPrefName}" /></td>
														<td><apex:outputText value="{!shortFormPreferences[idx].lotteryStatus}" /></td>
														<!-- <td><apex:outputField value="{!shortFormPreferences[idx].sfp.If_combined_individual_preference__c}" /></td> -->
														<td><apex:outputText value="{!shortFormPreferences[idx].personWhoClaimed}" /></td>
														<td><apex:outputField value="{!shortFormPreferences[idx].sfp.Type_of_proof__c}" /></td>
														<td><apex:outputField value="{!shortFormPreferences[idx].sfp.Preference_Lottery_Rank__c}" /></td>
														<!-- <td><apex:outputField value="{!shortFormPreferences[idx].sfp.Opt_Out__c}" /></td> -->
														<td style="text-align: center;">
															<apex:outputPanel rendered="{!shortFormPreferences[idx].sfp.Opt_Out__c}" layout="none">
																<span class="glyphicon glyphicon-ok"></span>
															</apex:outputPanel>
														</td>
													</tr>
												</apex:repeat>
											</tbody>
										</table>
									</apex:outputPanel>
								</div>
							</div>
						</div>
	
					<apex:outputPanel layout="block" styleClass="section text-center">
						<apex:inputHidden id="selectedShortFormPreferenceIdx" value="{!selectedShortFormPreferenceIdx}" />
	
						<apex:commandButton styleClass="btn btn-primary" value="New"
											rendered="{!currentShortFormPreference == null}"
											action="{!newShortFormPreference}" reRender="specialProgramPreferencesSection, errorMessages" />
						<apex:commandButton styleClass="btn btn-primary" value="Edit"
											rendered="{!currentShortFormPreference == null && shortFormPreferences.size > 0}"
											action="{!editShortFormPreference}" reRender="specialProgramPreferencesSection, errorMessages"
											id="shortFormPreferenceEdit" /><!-- oncomplete="afterEditShortFormPreferenceClick()" -->
						<apex:commandButton styleClass="btn btn-primary" value="Delete"
											onclick="beforeDeleteShortFormPreference(); return false;"
											rendered="{!currentShortFormPreference == null && shortFormPreferences.size > 0}"
											id="shortFormPreferenceDelete" />

						<apex:outputPanel layout="block" rendered="{!currentShortFormPreference != null}">
							<div id="shortFormPreferenceSection">
								<div class="row">
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">Preference Name</label>
											<div class="col-sm-6">
												<apex:selectList value="{!selectedListingPreference}"
																 id="prefName" styleClass="form-control required" size="1"
																 onchange="rerenderSpecialProgramPreferencesSection();">
													<apex:selectOptions value="{!listingPreferenceSO}"/>  
												</apex:selectList>
											</div>
										</div>
									</div>
									<apex:outputPanel layout="block" rendered="{!showHHMember}" styleClass="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">Which HH Member is on the Proof?</label>
											<div class="col-sm-6">
												<apex:selectList value="{!selectedApplicationMember}"
																 id="hhMember" styleClass="form-control required" size="1">
													<apex:selectOptions value="{!householdMembersSO}"/>
												</apex:selectList>
											</div>
										</div>
									</apex:outputPanel>
									<apex:outputPanel id="rentBurdenName" layout="none">
										<apex:outputPanel layout="block" rendered="{!showRentBurden && currentShortFormPreference.sfp.If_combined_individual_preference__c != 'Assisted Housing'}" styleClass="col-sm-6">
											<div class="form-group">
												<label class="col-sm-6 control-label"></label>
												<div class="col-sm-6" style="height:35px;">
												</div>
											</div>
										</apex:outputPanel>
										<apex:outputPanel layout="block" rendered="{!showRentBurden && currentShortFormPreference.sfp.If_combined_individual_preference__c == 'Assisted Housing'}" styleClass="col-sm-6">
											<div class="form-group">
												<label class="col-sm-6 control-label">Name on Lease</label>
												<div class="col-sm-6">
													<apex:selectList value="{!selectedApplicationMember}"
																	 id="nameOnLease" size="1" styleClass="form-control required">
														<apex:selectOptions value="{!householdMembersSO}"/>
													<!--	<apex:actionSupport event="onchange" rerender="preferenceBtns"/> -->
													</apex:selectList>
												</div>
											</div>
										</apex:outputPanel>
									</apex:outputPanel>
									<apex:outputPanel layout="block" rendered="{!showIndividualPreference}" styleClass="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">Individual Preference Name</label>
											<div class="col-sm-6">
												<!-- <apex:inputField value="{!currentShortFormPreference.sfp.If_combined_individual_preference__c}"
																 id="individualPreference" styleClass="form-control required"> -->
												<apex:selectList value="{!currentShortFormPreference.sfp.If_combined_individual_preference__c}" size="1"
																 id="individualPreference" styleClass="form-control required">
													<apex:selectOptions value="{!IndividualPrefs}"/>
													<apex:actionSupport event="onchange" oncomplete="checkPref(this)" rerender="typeOfProof,rentBurdenName,rentBurden,rentBurdenHelpText"/>
												</apex:selectList>
											</div>
										</div>
									</apex:outputPanel>
									<apex:outputPanel layout="block" rendered="{!showNRHP || showAntiDTHP}" styleClass="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label"></label>
											<div class="col-sm-6">
												<!-- empty space -->
											</div>
										</div>
									</apex:outputPanel>
									<apex:outputPanel layout="block" rendered="{!showTypeOfProof}" styleClass="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">Type of Proof</label>
											<div class="col-sm-6">
												<apex:selectList value="{!currentShortFormPreference.sfp.Type_of_proof__c}"
																 id="typeOfProof" styleClass="form-control required" size="1">
													<apex:selectOptions value="{!typeOfProofs}"/>
												</apex:selectList>
																
												<!-- <apex:inputField value="{!currentShortFormPreference.sfp.Type_of_proof__c}"
																 id="typeOfProof" styleClass="form-control required">
												</apex:inputField> -->
											</div>
										</div>
									</apex:outputPanel>
									<apex:outputPanel layout="block" rendered="{!showCOPHolder}" styleClass="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">Name of COP holder</label>
											<div class="col-sm-6">
												<apex:selectList value="{!selectedApplicationMember}"
																 id="copHolder" styleClass="form-control required" size="1">
													<apex:selectOptions value="{!householdMembersSO}"/>
												</apex:selectList>
											</div>
										</div>
									</apex:outputPanel>
									<apex:outputPanel layout="block" rendered="{!showPersonWhoClaimed}" styleClass="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">Person Who Claimed</label>
											<div class="col-sm-6">
												<apex:selectList value="{!selectedApplicationMember}"
																 id="personWhoClaimed" size="1" styleClass="form-control required">
													<apex:selectOptions value="{!householdMembersSO}"/>
												</apex:selectList>
											</div>
										</div>
									</apex:outputPanel>
									<apex:outputPanel layout="block" rendered="{!showDTHP}" styleClass="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">DTHP Certificate Number</label>
											<div class="col-sm-6">
												<apex:inputField value="{!currentShortFormPreference.sfp.Additional_Details__c}"
																 id="certNumber" styleClass="form-control">
												</apex:inputField>
											</div>
										</div>
									</apex:outputPanel>
									<apex:outputPanel id="rentBurden" layout="block">
										<apex:outputPanel layout="block" rendered="{!showRentBurden && currentShortFormPreference.sfp.If_combined_individual_preference__c == 'Rent Burdened'}" styleClass="col-sm-6">
											<div class="form-group">
												<label class="col-sm-6 control-label">Total Household Monthly Rent</label>
												<div class="col-sm-6">
													<apex:inputField value="{!app.Total_Monthly_Rent__c}" styleClass="form-control required">
														 <apex:actionSupport event="onkeyup" action="{!getMonthlyRentPecentage}" rerender="rentBurdenHelpText" oncomplete="eligibleForRBP({!monthlyRentPecentage})"/>
													</apex:inputField> <p id="demo">
                                                    
                                                    </p>
												</div>
											</div>
										</apex:outputPanel>
									</apex:outputPanel>
								</div>
								<apex:outputPanel layout="block" rendered="{!showCOPHolder || showDTHP}">
									<div class="row">
										<div class="col-sm-12">
											<p style="text-align: left;">MOHCD will verify that the applicant holds a valid certificate. No proof is required.</p>
										</div>
									</div>
								</apex:outputPanel>
								<apex:outputPanel layout="block" rendered="{!showLiveWork}">
									<div class="row">
										<div class="col-sm-12">
											<p style="text-align: left;">Please check to make sure that a document proving the preference address was attached to the application. If no proof document was attached, do not select this preference.</p>
										</div>
									</div>
								</apex:outputPanel>
								<apex:outputPanel layout="block" rendered="{!showNRHP || showAntiDTHP}">
									<div class="row">
										<div class="col-sm-12">
											<p style="text-align: left;">
												Please check to make sure that a document proving the preference address was attached to the application. If no proof document was attached, do not select this preference.<br/>
												If the HH member name on the proof is not the primary applicant, you must enter their residence address in the Household Members table above. MOHCD will verify that their address qualifies for this preference.
											</p>
										</div>
									</div>
								</apex:outputPanel>
								<apex:outputPanel id="rentBurdenHelpText">
									<apex:outputPanel layout="block" rendered="{!showRentBurden && currentShortFormPreference.sfp.If_combined_individual_preference__c == 'Assisted Housing'}">
										<div class="row">
											<div class="col-sm-12">
												<p style="text-align: left;">
													Do not give this preference unless applicant has provided a lease.<br/>
													If the person who lives in assisted housing is not the primary applicant, enter their address in the Household Members table above.<br/>
													
													<div class="form-inline" style="text-align: left; padding-left: 10px;">
														<div class="form-group">
															<div class="checkbox">
																<label>
																	<apex:inputCheckbox value="{!providedLease}" styleClass="form-control" id="provideLease" >
																		<apex:actionSupport event="onchange" oncomplete="toggleButtonsRBPAHP(this)" rerender="preferenceBtns"/>
																	</apex:inputCheckbox>
																	&nbsp;Did applicant provide a lease showing this household member's name?
																</label>
															</div>
														</div>
													</div>
												</p>
											</div>
										</div>
									</apex:outputPanel>
									<apex:outputPanel layout="block" rendered="{!showRentBurden && currentShortFormPreference.sfp.If_combined_individual_preference__c == 'Rent Burdened'}">
										<div class="row">
											<div class="col-sm-12">
												<apex:outputPanel rendered="{!app.Annual_Income__c == null}" layout="block">
													<div style="width: 100%; height: 50px; background-color: #EFE4B0; padding:15px;">
														Total Household Income has not been entered. Enter above to calculate if applicant is eligible to apply for Rent Burdened preference.
													</div><br/>
												</apex:outputPanel>
												<apex:outputPanel rendered="{!app.Annual_Income__c != null && app.Total_Monthly_Rent__c != null && monthlyRentPecentage < 50}" layout="block">
													<div style="width: 100%; height: 50px; background-color: #FBC8CA; padding:15px;">
														Total Household rent is less than 50% of income. Applicant is not allowed to apply for this preference.
													</div><br/>
												</apex:outputPanel>
												<apex:outputPanel rendered="{!app.Total_Monthly_Rent__c != null && monthlyRentPecentage >= 50}" layout="block">
													<div style="width: 100%; height: 50px; background-color: #ACF0C0; padding:15px;">
														Total Household rent is 50% or more of Total Household Income. Applicant is allowed to apply for Rent Burdened preference.
													</div><br/>
													<p style="text-align: left;">
														Do not give this preference unless applicant has provided a lease and proof of rent payment.<br/>
														
														<div class="form-inline" style="text-align: left; padding-left: 10px;">
															<div class="form-group">
																<div class="checkbox">
																	<label>
																		<apex:inputCheckbox id="includeLease" value="{!includedLease}" styleClass="form-control" >
																			<apex:actionSupport event="onchange" oncomplete="toggleButtonsRBPAHP(this)" rerender="preferenceBtns"/>
																		</apex:inputCheckbox>
																		&nbsp;Did applicant include lease(s) showing this Total Household Rent?
																	</label>
																</div>
															</div>
															<br/>
															<div class="form-group">
																<div class="checkbox">
																	<label>
																		<apex:inputCheckbox id="rentProof" value="{!providedProof}" styleClass="form-control" >
																			<apex:actionSupport event="onchange" oncomplete="toggleButtonsRBPAHP(this)" rerender="preferenceBtns"/>
																		</apex:inputCheckbox>
																		&nbsp;Did applicant provide 3 months of rent payment proof showing the Total Household Rent reported?
																	</label>
																</div>
															</div>
														</div>
														
														
													</p>
												</apex:outputPanel>
											</div>
										</div>
									</apex:outputPanel>
								</apex:outputPanel>
								<!-- <div class="row">
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">Type of Proof</label>
											<div class="col-sm-6">
												<apex:inputField value="{!currentShortFormPreference.sfp.Type_of_proof__c}" styleClass="form-control" />
											</div>
										</div>
									</div>
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-6 control-label">Opt Out</label>
											<div class="col-sm-6">
												<apex:inputField value="{!currentShortFormPreference.sfp.Opt_Out__c}" styleClass="form-control" />
											</div>
										</div>
									</div>
								</div> -->
							</div>
						</apex:outputPanel>
	
						<apex:actionFunction name="addShortFormPreference" action="{!addShortFormPreference}"
											 reRender="specialProgramPreferencesSection, errorMessages"
											 oncomplete="afterAddShortFormPreferenceClick()" />
						<apex:actionFunction name="addShortFormPreferenceAndNew" action="{!addShortFormPreferenceAndNew}"
											 reRender="specialProgramPreferencesSection, errorMessages"
											 oncomplete="afterAddShortFormPreferenceAndNewClick()" />
						<apex:actionFunction name="saveShortFormPreference" action="{!saveShortFormPreference}"
											 reRender="specialProgramPreferencesSection, errorMessages"
											 oncomplete="cancelShortFormPreference()" />
						<apex:actionFunction name="cancelShortFormPreference" action="{!cancelEditShortFormPreference}"
											 reRender="specialProgramPreferencesSection, errorMessages" immediate="true"
											 oncomplete="afterCancelShortFormPreferenceClick()" />
						<apex:actionFunction name="deleteShortFormPreference" action="{!deleteShortFormPreference}"
											 reRender="specialProgramPreferencesSection, errorMessages"
											 oncomplete="afterDeleteShortFormPreference()" />
						<apex:actionFunction name="rerenderSpecialProgramPreferencesSection" action="{!refreshShortFormPreference}"
											 reRender="specialProgramPreferencesSection" />
						<apex:actionFunction name="disablePrefBtn" action="{!getMonthlyRentPecentage}" 
											 rerender="preferenceBtns,rentBurdenHelpText"
											 oncomplete="disableButton()" >
							<!-- <apex:param name="isDisabled" value=""/> -->
						</apex:actionFunction>
						
						<apex:outputPanel id="preferenceBtns" layout="block">
							<apex:outputPanel layout="none" rendered="{!currentShortFormPreference != null && selectedShortFormPreferenceIdx == -1}">
								<button type="button" id="add" class="btn btn-primary"
										onclick="sanitizeFields(); checkRequiredFields_shortFormPreference(addShortFormPreference);">
									Add
								</button>
							</apex:outputPanel>
							<apex:outputPanel layout="none" rendered="{!currentShortFormPreference != null && selectedShortFormPreferenceIdx == -1}">
								<button type="button" id = "addNew" class="btn btn-primary"
										onclick="sanitizeFields(); checkRequiredFields_shortFormPreference(addShortFormPreferenceAndNew);">
									Add &amp; New
								</button>
							</apex:outputPanel>
							<apex:outputPanel layout="none" rendered="{!currentShortFormPreference != null && selectedShortFormPreferenceIdx != -1}">
								<button type="button" id="saveButton" class="btn btn-primary"
										onclick="sanitizeFields(); checkRequiredFields_shortFormPreference(saveShortFormPreference);">
									Save
								</button>
							</apex:outputPanel>
							<apex:outputPanel layout="none" rendered="{!currentShortFormPreference != null}">
								<button type="button" class="btn btn-primary"
										onclick="cancelShortFormPreference();">
									Cancel
								</button>
							</apex:outputPanel>
						</apex:outputPanel>
						
						</apex:outputPanel>
					</apex:outputPanel>
				</apex:actionRegion>

				<!-- <div class="form-group">
					<div class="col-xs-12 sectionHeader">
						<h5>Special Program Preferences</h5>
					</div>
				</div>
				<apex:outputPanel layout="block" styleClass="section form-group-section" id="specialProgramPreferencesSection1">
					<p class="doubleSpacing">Please check to make sure that a document proving the preference address was attached to the application. If no proof document was attached, do not enter anything below.</p>
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Which HH member name is on the Live in SF proof?</label>
								<div class="col-sm-6">
									<apex:selectList id="liveInSfPreference" value="{!liveInSfPreference}" size="1" styleClass="form-control">
										<apex:selectOptions value="{!householdMembersSO}"/>
									</apex:selectList>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">What type of document is the Live in SF proof?</label>
								<div class="col-sm-6">
									<apex:inputField value="{!app.Live_in_SF_Preference_Proof__c}" styleClass="form-control"/>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">Which HH member name is on the Work in SF proof?</label>
								<div class="col-sm-6">
									<apex:selectList id="workInSfPreference" value="{!workInSfPreference}" size="1" styleClass="form-control">
										<apex:selectOptions value="{!householdMembersSO}"/>
									</apex:selectList>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-6 control-label">What type of document is the Work in SF proof?</label>
								<div class="col-sm-6">
									<apex:inputField value="{!app.Work_in_SF_Preference_Proof__c}" styleClass="form-control"/>
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Which HH member name is on the Neighborhood proof?</label>
								<div class="col-sm-6">
									<apex:selectList id="neighborhoodPreference" value="{!neighborhoodPreference}" size="1" styleClass="form-control">
										<apex:selectOptions value="{!householdMembersSO}"/>
									</apex:selectList>
								</div>
							</div>
							<p><em>If the person selected above is not the primary applicant, you must enter their residence address in the Household Members table above. MOHCD will verify that their address qualifies for NHRP.</em></p>
							<div class="form-group">
								<label class="col-sm-6 control-label">What type of document is the NRHP proof?</label>
								<div class="col-sm-6">
									<apex:inputField value="{!app.Neighborhood_Preference_Proof__c}" styleClass="form-control"/>
								</div>
							</div>
						</div>
					</div>
					<hr />
					<p class="doubleSpacing">For the following preferences, MOHCD will verify that the applicant holds a valid certificate. No proof is required.</p>
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Name of DTHP certificate holder</label>
								<div class="col-sm-6">
									<apex:selectList id="dthpPreference" value="{!dthpPreference}" size="1" styleClass="form-control">
										<apex:selectOptions value="{!householdMembersSO}"/>
									</apex:selectList>
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Name of COP holder</label>
								<div class="col-sm-6">
									<apex:selectList id="copPreference" value="{!copPreference}" size="1" styleClass="form-control">
										<apex:selectOptions value="{!householdMembersSO}"/>
									</apex:selectList>
								</div>
							</div>
						</div>
					</div>
				</apex:outputPanel> -->
				
				
				<div class="form-group">
					<div class="col-xs-12 sectionHeader">
						<h5>Demographic Information</h5>
					</div>
				</div>
				<div class="section form-group-section">
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Gender</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Gender__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Sexual Orientation</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Sexual_Orientation__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Gender Specify (If Not Listed)</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Gender_Other__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Orientation Specify (If Not Listed)</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Sexual_Orientation_Other__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Sex at Birth</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Sex_at_Birth__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Race</label>
								<div class="col-sm-6">
									<div class="dependentPicklistWrapper">
										<apex:inputField value="{!primaryApplicant.Race__c}" />
									</div>
								</div>
							</div>
						</div>
					</div>
                    <div class="row">
                    <div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-6 control-label">Ethnicity</label>
								<div class="col-sm-6">
									<apex:inputField value="{!primaryApplicant.Ethnicity__c}" styleClass="form-control" />
								</div>
							</div>
						</div>
                    </div>
				</div>
				<div class="col-xs-12">
					<div class="form-inline">
						<div class="form-group" style="padding: 10px 0;">
							<div class="checkbox">
								<label>
									Signature on Terms of Agreement&ensp;&nbsp;
									<apex:inputField value="{!app.Terms_Acknowledged__c}" styleClass="form-control" />
								</label>
							</div>
						</div>
					</div>
				</div>
				<div class="form-group">
					<div class="col-xs-12 sectionHeader">
						<apex:commandButton styleClass="btn btn-primary" value="Save"
											onclick="sanitizeFields(); checkRequiredFields_primaryApplicant(saveApplicationForm); return false;" />
						<apex:commandButton styleClass="btn btn-primary" value="Save & New"
											onclick="sanitizeFields(); checkRequiredFields_primaryApplicant(saveApplicationFormAndNew); return false;" />
					</div>
				</div>
			</apex:form>
		</div>
		</apex:define>

		<apex:define name="scripts">
			<script src="{!URLFOR($Resource.HOP, '/js/moment.min.js')}"></script>
			<script src="{!URLFOR($Resource.HOP, '/js/jquery.datetimepicker.js')}"></script>
			<script src="{!URLFOR($Resource.HOP, '/js/typeahead.bundle.min.js')}"></script>
			<script src="{!URLFOR($Resource.HOP, '/js/bootbox.min.js')}"></script>
			<script src="{!URLFOR($Resource.SalesforceDataTables, '/js/jquery.dataTables.min.js')}"></script>
			<script src="{!URLFOR($Resource.SalesforceDataTables, '/js/dataTables.bootstrap.min.js')}"></script>

			<script>
				Date.parseDate = function(input, format) {
					return moment(input,format).toDate();
				};
				Date.prototype.dateFormat = function(format) {
					return moment(this).format(format);
				};

				function addPageError(html) {
					document.getElementById('responseErrors').innerHTML =
						'<button type="button" class="close" aria-label="Close" onclick="document.getElementById(\'responseErrors\').innerHTML = \'\';">' +
							'<span aria-hidden="true">&times;</span>' +
						'</button>' + html;
				}
				
				function encodeHTML(s) {
				    return s.replace(/</g, '&lt;').replace(/>/g, '&gt;');
				}

				function checkRequiredFields(wrapperId, postCheckRun) {
					var toFocus;
					$('#' + wrapperId + ' .required').each(function() {
						var $e = $(this);
						if (!$e.val() || $e.val() == -1) {
							$e.addClass('input-error');
							(function($e) {
								window.setTimeout( function() { $e.removeClass('input-error'); }, 1000 );
							})($e);
							if (!toFocus) toFocus = $e;
						}
					});
					if (toFocus) {
						toFocus.focus();
					} else {
						postCheckRun();
					}
				}

				function sanitizeFields() {
					$('#myFormWrapper').find('input,textarea').val(function(i, v) {
						return encodeHTML(v);
					});
				}

				function checkRequiredFields_primaryApplicant(postCheckRun) {
					checkRequiredFields('primaryApplicantSection', postCheckRun);
				}

				function checkRequiredFields_householdMember(postCheckRun) {
					checkRequiredFields('householdMemberSection', postCheckRun);
				}
				
				function checkRequiredFields_shortFormPreference(postCheckRun) {
					checkRequiredFields('shortFormPreferenceSection', postCheckRun);
				}

				/*
				function remotingErrorHandler(event) {
					if (event.status) {
						return true;
					} else if (event.type === 'exception') {
						console.log(event);
						addPageError('Exception: ' + event.message + '<br/>\nMethod: ' + event.method + '<br/>\nStack trace: ' + event.where);
					} else {
						console.log(event);
						addPageError('Error (type ' + (event.type || 'none') + '): ' + event.message);
					}
					return false;
				}
				*/

				function householdMemberRowSelect($row, idx) {
					$row.parent().children('tr.selected').removeClass('selected');
					$row.addClass('selected');
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberEdit').prop('disabled', false);
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberDelete').prop('disabled', false);
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:selectedHouseholdMemberIdx').val(idx);
				}

				function householdMemberRowDeselect($row) {
					if ($row) $row.removeClass('selected');
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberEdit').prop('disabled', true);
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberDelete').prop('disabled', true);
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:selectedHouseholdMemberIdx').val(-1);
				}

				function onHouseholdMemberRowClick(row, idx) {
					var $row = $(row);
					
					if ($row.hasClass('selected')) {
						householdMemberRowDeselect($row);
					} else {
						householdMemberRowSelect($row, idx)
					}
				}

				function afterNewHouseholdMemberClick() {
					rebuildDateTimePicker('dateOfBirth_chm');
					rebuildDataTable();
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberFirstName').focus();
				}

				function afterEditHouseholdMemberClick() {
					rebuildDateTimePicker('dateOfBirth_chm');
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberFirstName').focus();
				}

				function afterAddHouseholdMemberClick() {
					rebuildDataTable();
				}

				function afterAddHouseholdMemberAndNewClick() {
					rebuildDateTimePicker('dateOfBirth_chm');
					rebuildDataTable();
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberFirstName').focus();
				}

				function afterSaveMemberClick() {
					rebuildDataTable();
				}

				function afterCancelHouseholdMemberClick() {
					rebuildDataTable();
				}

				function beforeDeleteHouseholdMember() {
					bootbox.confirm({ 
						size: 'small',
						closeButton: false,
						message: 'Are you sure you want to delete this member?', 
						callback: function(result) {
							if (result) deleteHouseholdMember();
						}
					});
				}

				function afterDeleteHouseholdMember() {
					rebuildDataTable();
				}
	
				function rebuildDateTimePicker(id) {
					var $elem = $('#' + id);
					var $VFelem = $('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:' + id);
					var val = $VFelem.val();
					$elem.datetimepicker({
						timepicker: false,
						scrollMonth: false,
						format: 'M/D/YYYY',
						formatDate: 'M/D/YYYY',
						closeOnDateSelect: true,
						value: val || null,
						onChangeDateTime: function() {
							$VFelem.val($elem.val());
						}
					});
				}

				function rebuildDataTable() {
					$('#householdMembersTable').DataTable({
						'paging': true,
						'ordering': true,
						'info': true,
						'searching': true
					});
					householdMemberRowDeselect();
				}

				$(document).ready(function() {
					rebuildDateTimePicker('dateOfBirth');
					if ({!householdMembers.size > 0}) {
						rebuildDataTable();
					}
				});
				
				//preferences
				function shortFormPreferenceRowSelect($row, idx) {
					$row.parent().children('tr.selected').removeClass('selected');
					$row.addClass('selected');
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:shortFormPreferenceEdit').prop('disabled', false);
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:shortFormPreferenceDelete').prop('disabled', false);
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:selectedShortFormPreferenceIdx').val(idx);
				}

				function shortFormPreferenceRowDeselect($row) {
					if ($row) $row.removeClass('selected');
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:shortFormPreferenceEdit').prop('disabled', true);
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:shortFormPreferenceDelete').prop('disabled', true);
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:selectedShortFormPreferenceIdx').val(-1);
				}
				
				function disableBtn(isDisabled) {
					console.log('disable btn');
					console.log('{!disableAddBtn}');
					console.log(isDisabled);
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberEdit').prop('disabled', true);
					
				}

				function onShortFormPreferenceRowClick(row, idx) {
					var $row = $(row);
					
					if ($row.hasClass('selected')) {
						shortFormPreferenceRowDeselect($row);
					} else {
						shortFormPreferenceRowSelect($row, idx)
					}
				}

				/*function afterEditHouseholdMemberClick() {
					rebuildDateTimePicker('dateOfBirth_chm');
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberFirstName').focus();
				}*/

				function afterAddShortFormPreferenceClick() {
					rebuildShortFormPreferenceDataTable();
				}

				function afterAddShortFormPreferenceAndNewClick() {
					rebuildDateTimePicker('dateOfBirth_chm');
					rebuildShortFormPreferenceDataTable();
					$('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberFirstName').focus();
				}

				function afterSaveShortFormPreferenceClick() {
					rebuildShortFormPreferenceDataTable();
				}

				function afterCancelShortFormPreferenceClick() {
					rebuildShortFormPreferenceDataTable();
				}

				function beforeDeleteShortFormPreference() {
					bootbox.confirm({ 
						size: 'small',
						closeButton: false,
						message: 'Are you sure you want to delete this member?', 
						callback: function(result) {
							if (result) deleteShortFormPreference();
						}
					});
				}

				function afterDeleteShortFormPreference() {
					rebuildShortFormPreferenceDataTable();
				}
	
				function rebuildDateTimePicker(id) {
					var $elem = $('#' + id);
					var $VFelem = $('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:' + id);
					var val = $VFelem.val();
					$elem.datetimepicker({
						timepicker: false,
						scrollMonth: false,
						format: 'M/D/YYYY',
						formatDate: 'M/D/YYYY',
						closeOnDateSelect: true,
						value: val || null,
						onChangeDateTime: function() {
							$VFelem.val($elem.val());
						}
					});
				}

				function rebuildShortFormPreferenceDataTable() {
					$('#shortFormPreferencesTable').DataTable({
						'paging': true,
						'ordering': true,
						'info': true,
						'searching': true
					});
					shortFormPreferenceRowDeselect();
				}

				$(document).ready(function() {
					rebuildDateTimePicker('dateOfBirth');
					if ({!shortFormPreferences.size > 0}) {
						rebuildShortFormPreferenceDataTable();
					}
				});
            
            function toggleButtons(check) {
                if(check == true) {
                if(document.getElementById('add') != null)
            		document.getElementById('add').disabled = false;
                if(document.getElementById('addNew') != null)
                	document.getElementById('addNew').disabled = false;
				if(document.getElementById('saveButton') != null)
                	document.getElementById('saveButton').disabled = false;
                }
                else {
                if(document.getElementById('add') != null)
                	document.getElementById('add').disabled = true;
                if(document.getElementById('addNew') != null)
                	document.getElementById('addNew').disabled = true;
                if(document.getElementById('saveButton') != null)
                	document.getElementById('saveButton').disabled = true;   
                }
            }
            
			 function toggleButtonsRBPAHP(comp) {
                if((comp.id).includes('rentProof') || (comp.id).includes('includeLease'))
                    rentBurdenProof();
                else assistedHousing();                   
            }        
            
            function checkPref(curr) {
                if(curr.options[curr.selectedIndex].value == 'Assisted Housing') 
					assistedHousing();
                
                if(curr.options[curr.selectedIndex].value == 'Rent Burdened') 
               		rentBurdenProof();
				}
            
            function rentBurdenProof() {
            	var rentProof = document.getElementById('{!$Component.myForm.rentProof}') != null ? document.getElementById('{!$Component.myForm.rentProof}').checked : false;
                var includeLease = document.getElementById('{!$Component.myForm.includeLease}') != null ? document.getElementById('{!$Component.myForm.includeLease}').checked : false;
                    if(rentProof && includeLease) 
                        toggleButtons(true); 
                    else toggleButtons(false);  
            	}
            
            function assistedHousing() {
            		var provideLease = document.getElementById('{!$Component.myForm.provideLease}') != null ? document.getElementById('{!$Component.myForm.provideLease}').checked : false;
                    console.log('provideLease ' + provideLease);
                	if(provideLease) 
                        toggleButtons(true); 
                    else toggleButtons(false); 
            	}
            
            function eligibleForRBP(rentPercent) {
            	if(rentPercent > 50)
                    rentBurdenProof();
                else toggleButtons(false);
            }
			</script>
		</apex:define>
	</apex:composition>
</apex:page>